---
layout: default
title: Bikes
permalink: /bikes/
container_class: bikes
---
<script>
  var bikes = [
    {"id": "1", "name": "Crosscheck", "docKey": "0AmHVoD078iZkdEgwUDR5UE9PVHU4TVAzanFqTnAtb3c&gid=0"},
    {"id": "2", "name": "Juice 29er", "docKey": "0AmHVoD078iZkdEgwUDR5UE9PVHU4TVAzanFqTnAtb3c&gid=4"}
  ];

  var images = [
    'http://photos-b.ak.instagram.com/hphotos-ak-prn/10326509_1450486858522977_1847487666_n.jpg',
    'http://photos-a.ak.instagram.com/hphotos-ak-ash/10246047_704403556272464_1233639768_n.jpg',
    'http://photos-d.ak.instagram.com/hphotos-ak-prn/927487_609050819156331_231200829_n.jpg',
    'http://photos-c.ak.instagram.com/hphotos-ak-frc/914530_766050640087554_2096732005_n.jpg'
  ];

  function getURLParameter(name) {
    return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search)||[,""])[1].replace(/\+/g, '%20'))||null
  }

  function buildData(rows) {
    var formattedData = [];
    for(var i=1; i < rows.length; i++) {
      var part = {};
      for(var j=0; j < rows[0].length; j++) {
        part[rows[0][j].toLowerCase()] = rows[i][j];
      }
      formattedData.push(part);
    }
    return formattedData;
  }

  function renderImageTemplate(imageUrl) {
    var html = '<div class="mosaicflow__item">';
    html += '<img src="' + imageUrl + '" class="lightbox">';
    html += '</div>';
    return html;
  }

  function gramsToLbs(grams) {
    return (0.00220462 * grams).toPrecision(4);
  }

  function renderPart(part) {
    if (part.item) {
        var html = "";
        html += "<tr>";
        html += '<td><p>' + part.company + ' <strong>' + part.item + "</strong></p>";
        if (part.description) {
            html += '<p>' + part.description + "</p>";
        }
        html += '<ul class="list-inline">';
        html += "<li class='category'>" + part.partcategory + "</li>";
        html += "<li class='sub-category'>" + part.partsubcategory + "</li>";
        if (part.weight) {
          html += "<li class='weight'>" + part.weight + "g / " + gramsToLbs(part.weight) + "lbs</li>";
        }
        if (part.source) {
          html += "<li class='source'>" + part.source + "</li>";
        }
        html += "</ul></td>";
        html += "<td><span class='pull-right'>" + part.cost + "</span></td>";
        html += "</tr>";
        return html;
    }
  }

  function renderImages(container, next) {
    _.each(images, function(imageUrl) {
      console.log(container);
      // $(".mosaicflow").append(renderImageTemplate(imageUrl));
      // container.mosaicflow('add', $(renderImageTemplate(imageUrl));
        var elm = $('<div>A new added element</div>');
        container.append(renderImageTemplate(imageUrl));
      console.log('apend image');
    });
    return next()
  }

  $(document).ready(function () {
    var docUrl = "https://docs.google.com/spreadsheet/pub?output=csv&key=";
    var bikeId = parseInt(getURLParameter("id"));
    var bike;

    bikes.forEach(function (b) { 
      $(".bikes .nav").append('<li id="bike-' + b.id + '""><a href="?id=' + b.id + '">' + b.name + '</a></li>');
    });

    if (bikeId) {
      bike = bikes[bikeId - 1];
    } else {
      bike = bikes[0];
    }
    docUrl += bike.docKey;
    $(".bikes li").removeClass("active");
    $("#bike-" + bike.id).addClass("active");

    $.get(docUrl)
      .pipe( CSV.parse )
      .done( function(rows) {
        bikeParts = buildData(rows);
        var html = "";
         for( var i =0; i < bikeParts.length; i++){
            html += renderPart(bikeParts[i]);
         }
         $(".bikes table").append(html);
    });
  }); 

</script>

<div class="bikes">
  <ul class="nav nav-pills nav-justified"></ul>

  <table class="table table-striped"></table>
</div>
